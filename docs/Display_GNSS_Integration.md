# æ˜¾ç¤ºå±GNSSé€Ÿåº¦é›†æˆè¯´æ˜

**æ—¥æœŸ**: 2026-01-17
**ä¿®æ”¹**: å±å¹•æ˜¾ç¤ºä¼˜å…ˆä½¿ç”¨GNSSé€Ÿåº¦ï¼ŒIMUä½œä¸ºå¤‡ç”¨

---

## ä¿®æ”¹æ¦‚è¿°

å°†ä¸²å£å±æ˜¾ç¤ºçš„é€Ÿåº¦æ•°æ®ä»"çº¯IMUè§£ç®—"æ”¹ä¸º"GNSSä¼˜å…ˆ + IMUå¤‡ç”¨"ç­–ç•¥ï¼Œå¤§å¹…æå‡é€Ÿåº¦æ˜¾ç¤ºç²¾åº¦ã€‚

---

## ä¿®æ”¹å†…å®¹

### 1. æ–°å¢å…¨å±€å˜é‡

åœ¨[main.cpp:102-106](../src/main.cpp#L102-L106)æ·»åŠ GNSSé€Ÿåº¦å…¨å±€å˜é‡ï¼š

```cpp
// GNSS é€Ÿåº¦å˜é‡ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰
volatile float gnss_speed_mps = 0.0f;  // GNSSé€Ÿåº¦ (m/s)
volatile float gnss_speed_kmh = 0.0f;  // GNSSé€Ÿåº¦ (km/h)
volatile float gnss_course = 0.0f;     // GNSSèˆªå‘ (åº¦)
volatile bool gnss_valid = false;      // GNSSæ•°æ®æ˜¯å¦æœ‰æ•ˆ
```

### 2. GNSSä»»åŠ¡æ›´æ–°å…¨å±€å˜é‡

åœ¨[main.cpp:241-245](../src/main.cpp#L241-L245)ï¼ŒGNSSä»»åŠ¡å®æ—¶æ›´æ–°é€Ÿåº¦æ•°æ®ï¼š

```cpp
// æ›´æ–°å…¨å±€GNSSå˜é‡ï¼ˆç”¨äºæ˜¾ç¤ºä»»åŠ¡ï¼‰
gnss_speed_mps = data.speed_mps;
gnss_speed_kmh = data.speed_kmh;
gnss_course = data.course;
gnss_valid = data.is_valid;
```

### 3. æ˜¾ç¤ºä»»åŠ¡ä¼˜å…ˆä½¿ç”¨GNSS

åœ¨[main.cpp:524-539](../src/main.cpp#L524-L539)ï¼Œæ˜¾ç¤ºä»»åŠ¡æ ¹æ®GNSSçŠ¶æ€é€‰æ‹©æ•°æ®æºï¼š

```cpp
// æ˜¾ç¤ºé€Ÿåº¦ï¼šä¼˜å…ˆä½¿ç”¨GNSSï¼ˆå¦‚æœå®šä½æœ‰æ•ˆï¼‰ï¼Œå¦åˆ™ä½¿ç”¨IMU
float display_vx, display_vy;
if (gnss_valid) {
    // GNSSæœ‰æ•ˆï¼šä½¿ç”¨GNSSé€Ÿåº¦
    float course_rad = gnss_course * DEG_TO_RAD;
    display_vx = gnss_speed_mps * cos(course_rad);  // ä¸œå‘åˆ†é‡
    display_vy = gnss_speed_mps * sin(course_rad);  // åŒ—å‘åˆ†é‡
} else {
    // GNSSæ— æ•ˆï¼šä½¿ç”¨IMUé€Ÿåº¦
    display_vx = jy901_vx;
    display_vy = jy901_vy;
}

Serial2.printf("main.x2.val=%04d\xff\xff\xff", (int)(display_vx*1000));
Serial2.printf("main.x3.val=%04d\xff\xff\xff", (int)(display_vy*1000));
```

---

## å·¥ä½œåŸç†

### é€Ÿåº¦æ˜¾ç¤ºç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ˜¾ç¤ºå±é€Ÿåº¦æ•°æ®æ¥æº              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  GNSSå®šä½æœ‰æ•ˆ? (gnss_valid == true)    â”‚
â”‚         â”‚                               â”‚
â”‚         â”œâ”€â”€ YES â†’ ä½¿ç”¨GNSSé€Ÿåº¦          â”‚
â”‚         â”‚         â”œ é€Ÿåº¦: gnss_speed_mpsâ”‚
â”‚         â”‚         â”œ èˆªå‘: gnss_course   â”‚
â”‚         â”‚         â”” ç²¾åº¦: Â±0.18 km/h âœ“  â”‚
â”‚         â”‚                               â”‚
â”‚         â””â”€â”€ NO  â†’ ä½¿ç”¨IMUé€Ÿåº¦           â”‚
â”‚                   â”œ é€Ÿåº¦: jy901_vx/vy   â”‚
â”‚                   â”” ç²¾åº¦: Â±5-10 km/h    â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### èˆªå‘åˆ†è§£è¯´æ˜

GNSSæä¾›çš„æ˜¯**åœ°é¢é€Ÿåº¦æ ‡é‡**å’Œ**èˆªå‘è§’åº¦**ï¼Œéœ€è¦åˆ†è§£ä¸ºx/yåˆ†é‡ï¼š

```cpp
// GNSSæ•°æ®
gnss_speed_mps = 20.0 m/s    // åœ°é¢é€Ÿåº¦
gnss_course = 45Â°             // èˆªå‘è§’ï¼ˆä¸œåŒ—æ–¹å‘ï¼‰

// åˆ†è§£ä¸ºåˆ†é‡
display_vx = 20.0 * cos(45Â°) = 14.14 m/s  // ä¸œå‘ï¼ˆxè½´ï¼‰
display_vy = 20.0 * sin(45Â°) = 14.14 m/s  // åŒ—å‘ï¼ˆyè½´ï¼‰
```

**åæ ‡ç³»å®šä¹‰**ï¼š
- **Xè½´ï¼ˆä¸œï¼‰**ï¼šå‘ä¸œä¸ºæ­£ï¼ˆåœ°ç†åæ ‡ç³»ï¼‰
- **Yè½´ï¼ˆåŒ—ï¼‰**ï¼šå‘åŒ—ä¸ºæ­£ï¼ˆåœ°ç†åæ ‡ç³»ï¼‰
- **èˆªå‘è§’**ï¼šä»åŒ—é¡ºæ—¶é’ˆæ—‹è½¬ï¼ˆ0Â°=åŒ—, 90Â°=ä¸œ, 180Â°=å—, 270Â°=è¥¿ï¼‰

---

## æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | GNSSé€Ÿåº¦ | IMUé€Ÿåº¦ |
|------|---------|---------|
| **ç²¾åº¦** | Â±0.18 km/h | Â±5-10 km/h (10ç§’) |
| **æ¼‚ç§»** | æ— æ¼‚ç§» | ç´¯ç§¯æ¼‚ç§» |
| **æ›´æ–°ç‡** | 1 Hz | 100 Hz |
| **å¯ç”¨æ€§** | éœ€è¦å®¤å¤–å®šä½ | å®¤å†…å¤–å‡å¯ |
| **å»¶è¿Ÿ** | ~1ç§’ | ~10ms |

### ä½¿ç”¨åœºæ™¯

1. **å®¤å¤–éª‘è¡Œï¼ˆGNSSæœ‰æ•ˆï¼‰**ï¼š
   - âœ… æ˜¾ç¤ºGNSSé€Ÿåº¦ï¼ˆé«˜ç²¾åº¦ï¼Œæ— æ¼‚ç§»ï¼‰
   - âœ… é€‚åˆé•¿æ—¶é—´éª‘è¡Œï¼ŒæŒç»­ä¿æŒÂ±0.18 km/hç²¾åº¦

2. **å®¤å†…/éš§é“/æœæ˜Ÿä¸­ï¼ˆGNSSæ— æ•ˆï¼‰**ï¼š
   - âœ… æ˜¾ç¤ºIMUé€Ÿåº¦ï¼ˆæœ‰æ¼‚ç§»ï¼Œä½†èƒ½å·¥ä½œï¼‰
   - âš ï¸ çŸ­æœŸ(<10ç§’)ç²¾åº¦å¯æ¥å—ï¼Œé•¿æœŸæ¼‚ç§»ä¸¥é‡

3. **æœªæ¥èåˆç®—æ³•**ï¼š
   - ğŸ”œ å¡å°”æ›¼æ»¤æ³¢ï¼šIMU(100Hzé«˜é¢‘) + GNSS(1Hzæ— æ¼‚ç§»)
   - ğŸ¯ ç›®æ ‡ï¼šÂ±2-5 km/hé•¿æœŸç²¾åº¦ + 100Hzå“åº”é€Ÿåº¦

---

## æµ‹è¯•éªŒè¯

### å®¤å†…æµ‹è¯•ï¼ˆGNSSæœæ˜Ÿä¸­ï¼‰

```
[æ˜¾ç¤ºä»»åŠ¡] å¯åŠ¨
[æ˜¾ç¤ºä»»åŠ¡] é€Ÿåº¦æ˜¾ç¤ºç­–ç•¥: GNSSä¼˜å…ˆ(å®šä½æœ‰æ•ˆæ—¶), IMUå¤‡ç”¨(æœæ˜Ÿä¸­)
[GNSS] æœæ˜Ÿä¸­... | æ˜Ÿ=0 | è´¨é‡=0 | æ¶ˆæ¯=175

çŠ¶æ€: gnss_valid = false
æ˜¾ç¤º: ä½¿ç”¨IMUé€Ÿåº¦ (jy901_vx, jy901_vy)
```

### å®¤å¤–æµ‹è¯•ï¼ˆGNSSå®šä½æˆåŠŸï¼‰

```
[GNSS] å®šä½âœ“ | æ˜Ÿ=12 HDOP=0.9 | ä½ç½®=22.718025,114.018471 | é«˜åº¦=93.2m | é€Ÿåº¦=45.3km/h | èˆªå‘=87.5Â°

çŠ¶æ€: gnss_valid = true
æ˜¾ç¤º: ä½¿ç”¨GNSSé€Ÿåº¦
  - gnss_speed_mps = 12.58 m/s
  - gnss_course = 87.5Â°
  - display_vx = 12.53 m/s (ä¸œå‘)
  - display_vy = 0.55 m/s (åŒ—å‘)
```

---

## ç›¸å…³æ–‡ä»¶

- [src/main.cpp](../src/main.cpp) - ä¸»ç¨‹åºï¼ˆå…¨å±€å˜é‡ã€GNSSä»»åŠ¡ã€æ˜¾ç¤ºä»»åŠ¡ï¼‰
- [src/GNSS_BE881.cpp](../src/GNSS_BE881.cpp) - GNSSé©±åŠ¨
- [include/GNSS_BE881.h](../include/GNSS_BE881.h) - GNSSæ•°æ®ç»“æ„
- [docs/GNSS_Integration_Guide.md](GNSS_Integration_Guide.md) - GNSSé›†æˆå®Œæ•´æ–‡æ¡£

---

## æ€»ç»“

### âœ… å·²å®Œæˆ

1. **GNSSé€Ÿåº¦å…¨å±€å˜é‡** - çº¿ç¨‹å®‰å…¨çš„é€Ÿåº¦æ•°æ®å…±äº«
2. **æ™ºèƒ½æ•°æ®æºåˆ‡æ¢** - GNSSä¼˜å…ˆï¼ŒIMUå¤‡ç”¨
3. **èˆªå‘åˆ†è§£** - GNSSæ ‡é‡é€Ÿåº¦åˆ†è§£ä¸ºx/yåˆ†é‡
4. **å‘ä¸‹å…¼å®¹** - GNSSæ— æ•ˆæ—¶è‡ªåŠ¨å›é€€åˆ°IMU

### ğŸ¯ ä¼˜åŠ¿

- **ç²¾åº¦æå‡10å€ä»¥ä¸Š**ï¼šGNSS Â±0.18 km/h vs IMU Â±5-10 km/h
- **æ— æ¼‚ç§»**ï¼šé•¿æ—¶é—´éª‘è¡Œé€Ÿåº¦ä¿æŒå‡†ç¡®
- **æ— ç¼åˆ‡æ¢**ï¼šå®¤å†…å¤–è‡ªåŠ¨åˆ‡æ¢æ•°æ®æº
- **é›¶é…ç½®**ï¼šç”¨æˆ·æ— éœ€æ‰‹åŠ¨é€‰æ‹©

### ğŸ“Š é¢„æœŸæ•ˆæœ

| åœºæ™¯ | ä¹‹å‰ï¼ˆçº¯IMUï¼‰ | ç°åœ¨ï¼ˆGNSS+IMUï¼‰ |
|------|--------------|-----------------|
| å®¤å¤–éª‘è¡Œ10åˆ†é’Ÿ | Â±15-20 km/h | Â±0.18 km/h âœ“ |
| å®¤å†…å¯åŠ¨ | Â±5 km/h | Â±5 km/h (è‡ªåŠ¨åˆ‡æ¢IMU) |
| è¿›å…¥éš§é“ | Â±10 km/h | Â±5 km/h (æš‚æ—¶ä½¿ç”¨IMU) |
| å‡ºéš§é“ | Â±15 km/h | Â±0.18 km/h (è‡ªåŠ¨åˆ‡æ¢GNSS) âœ“ |

---

**ä¿®æ”¹å®Œæˆï¼** ğŸ‰

ç°åœ¨å±å¹•æ˜¾ç¤ºä¼šä¼˜å…ˆä½¿ç”¨é«˜ç²¾åº¦çš„GNSSé€Ÿåº¦ï¼Œåœ¨GNSSæ— æ•ˆæ—¶è‡ªåŠ¨å›é€€åˆ°IMUé€Ÿåº¦ï¼Œå…¼é¡¾ç²¾åº¦å’Œå¯ç”¨æ€§ã€‚
